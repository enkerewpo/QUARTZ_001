C51 COMPILER V9.60.7.0   HELLO                                                             08/13/2024 18:51:47 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE HELLO
OBJECT MODULE PLACED IN HELLO.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE HELLO.C OPTIMIZE(8,SPEED) BROWSE INCDIR(D:\Keil_v5\C51\INC\STC) DEBUG OB
                    -JECTEXTEND TABS(2)

line level    source

   1          #include "STC89C5xRC.H"
   2          #include "intrins.h"
   3          
   4          typedef unsigned char BYTE;
   5          typedef unsigned int WORD;
   6          
   7          // global buffer for RXD input
   8          BYTE buffer[32];
   9          BYTE buffer_index = 0;
  10          
  11          sbit bit0 = P1 ^ 0;
  12          sbit bit1 = P1 ^ 1;
  13          bit busy;
  14          
  15          void wait(unsigned int i);
  16          
  17          void Uart1_Init(void) // 2400bps@12.000MHz
  18          {
  19   1        PCON |= 0x80;
  20   1        SCON = 0x50;
  21   1        AUXR &= 0xBF;
  22   1        AUXR &= 0xFE;
  23   1        TMOD &= 0x0F;
  24   1        TMOD |= 0x20;
  25   1        TL1 = 0xE6;
  26   1        TH1 = 0xE6;
  27   1        TR1 = 1;
  28   1        ES = 1;
  29   1        EA = 1;
  30   1        // enable RXD to receive data
  31   1        SCON |= 0x10;
  32   1      }
  33          
  34          void Uart_Isr() interrupt 4 using 1 {
  35   1        if (RI) {
  36   2          RI = 0;
  37   2          buffer[buffer_index++] = SBUF;
  38   2          bit0 = RI;
  39   2        }
  40   1        if (TI) {
  41   2          TI = 0;
  42   2          busy = 0;
  43   2          bit1 = TI;
  44   2        }
  45   1      }
  46          
  47          void send_char(char c) {
  48   1        while (busy)
  49   1          ;
  50   1        // Wait for the last transmission to complete
  51   1        busy = 1;
  52   1        // Set the busy flag
  53   1        SBUF = c;
  54   1        // Send data to UART buffer
C51 COMPILER V9.60.7.0   HELLO                                                             08/13/2024 18:51:47 PAGE 2   

  55   1      }
  56          
  57          void send_str(char *s) {
  58   1        while (*s) {
  59   2          send_char(*s++);
  60   2        }
  61   1      }
  62          
  63          BYTE get_char() {
  64   1        while (buffer_index == 0)
  65   1          ;
  66   1        return buffer[--buffer_index];
  67   1      }
  68          
  69          BYTE tmp_char;
  70          
  71          void main() {
  72   1      
  73   1        Uart1_Init();
  74   1      
  75   1        send_str(
  76   1            "Welcome to QUARTZ_RT minimal OS for STC89 series microcontrollers\n\r");
  77   1        send_str("Author: wheatfox(enkerewpo@hotmail.com)");
  78   1        // enter shell
  79   1        while (1) {
  80   2          send_str("\n\r>");
  81   2          // read the full line until '\n'
  82   2          while (1) {
  83   3            tmp_char = get_char();
  84   3            if (tmp_char == '\n') {
  85   4              send_str("found newline\n\r");
  86   4              break;
  87   4            }
  88   3            send_char(tmp_char);
  89   3          }
  90   2        }
  91   1      }
  92          
  93          void wait(unsigned int i) {
  94   1        unsigned int j;
  95   1        for (j = 0; j < i; j++) {
  96   2          _nop_();
  97   2          _nop_();
  98   2          _nop_();
  99   2          _nop_();
 100   2          _nop_();
 101   2          _nop_();
 102   2          _nop_();
 103   2          _nop_();
 104   2        }
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    218    ----
   CONSTANT SIZE    =    128    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     34       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.60.7.0   HELLO                                                             08/13/2024 18:51:47 PAGE 3   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
